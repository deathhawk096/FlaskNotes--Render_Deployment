{% extends "layout.html" %}
{% block content %}
<div class="content-section">
    <form method="POST" action="" enctype="multipart/form-data">
        {{ form.hidden_tag() }}
        <fieldset class="form-group">
            <legend class="border-bottom mb-4">Join Today</legend>

            <!-- Title -->
            <div class="form-group">
                {{ form.title.label(class="form-control-label") }}
                {% if form.title.errors %}
                    {{ form.title(class="form-control form-control-lg is-invalid") }}
                    <div class="invalid-feedback">
                        {% for error in form.title.errors %}
                            <span>{{ error }}</span>
                        {% endfor %}
                    </div>
                {% else %}
                    {{ form.title(class="form-control form-control-lg") }}
                {% endif %}
            </div>

            <!-- Content -->
            <div class="form-group">
                {{ form.content.label(class="form-control-label") }}
                {% if form.content.errors %}
                    {{ form.content(class="form-control form-control-lg is-invalid") }}
                    <div class="invalid-feedback">
                        {% for error in form.content.errors %}
                            <span>{{ error }}</span>
                        {% endfor %}
                    </div>
                {% else %}
                    {{ form.content(class="form-control form-control-lg") }}
                {% endif %}
            </div>

            <!-- Images -->
            <div class="form-group">
                {{form.images.label()}}
                    {{form.images(class='form-control-file',id='images')}}
                    {% if form.images.errors %}
                        {% for error in form.images.errors %}
                        <span class="text-danger">{{error}}</span></br>
                        {% endfor%}
                    {% endif %}
                <!-- Image preview -->
                <div id="preview-container" style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap;"></div>
            </div>
        </fieldset>

        <div class="form-group">
            {{ form.submit(class="btn btn-outline-info") }}
        </div>
        <!-- Existing Images -->
        {% if note and note.images %}
        <div id="existing-images" style="margin-bottom:10px; display:flex; gap:10px; flex-wrap:wrap;">
        {% for img in note.images %}
            <div class="image-wrapper" style="position:relative; display:inline-block;">
            <img src="{{img.image_url}}"
                style="max-width:150px; border-radius:8px;">
            <!-- Simple link for delete -->
            <a href="{{ url_for('notes.delete_image', image_id=img.id) }}"
                style="position:absolute; top:5px; right:5px; background:red; color:white; padding:2px 6px; border-radius:50%; text-decoration:none;">
                âœ•
            </a>
            </div>
        {% endfor %}
        </div>
        {% endif %}
    </form>
</div>

<script>
document.getElementById('images').addEventListener('change', function(event) {
    const container = document.getElementById('preview-container');
    container.innerHTML = ""; // clear old previews
    for (const file of event.target.files) {
        if (file.type.startsWith("image/")) {
            const img = document.createElement("img");
            img.src = URL.createObjectURL(file);
            img.style.maxWidth = "150px";
            img.style.borderRadius = "8px";
            img.style.margin = "5px 0";
            container.appendChild(img);
        }
    }
});
</script>
{% endblock content %}
